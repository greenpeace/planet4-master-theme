const {__} = wp.i18n;

// Re-order completed posts in a actions list block into resistance hub.
const reorderCompletedPosts = () => {
  const actionsList = document.querySelector('.actions-list .wp-block-post-template');
  if (!actionsList) {
    return;
  }

  const posts = Array.from(actionsList.children);
  const completed = posts.filter(post => post.classList.contains('completed'));
  const notCompleted = posts.filter(post => !post.classList.contains('completed'));
  if (completed.length > 0) {
    actionsList.innerHTML = '';
    completed.forEach(post => actionsList.appendChild(post));
    notCompleted.forEach(post => actionsList.appendChild(post));
  }
};

const markActionsAsCompleted = () => {
  // Make sure customization is enabled in the settings
  const isCustomizationEnabled = Boolean(window.p4_vars.features.actions_user_personalization);
  if (!isCustomizationEnabled) {
    return;
  }

  // Initialise completed actions in local storage if needed.
  const completedActions = localStorage.getItem('completedActions');
  let completedActionsIds = [];
  if (!completedActions) {
    localStorage.setItem(completedActions, '');
  } else {
    completedActionsIds = completedActions.split(',');
  }

  const actions = document.querySelectorAll('.actions-list ul li, .boxout');
  if (!actions.length) {
    return;
  }

  // Mark completed actions and replace image with "completed" element.
  // For non-completed ones, update onclick function.
  actions.forEach(action => {
    const actionId = action.classList[1].replace('post-', '');
    if (!actionId) { // This can happen for custom Taxe Action Boxout blocks.
      return;
    }
    if (completedActionsIds.includes(actionId)) {
      action.classList.add('completed');
      const completedElement = document.createElement('div');
      const checkmark = document.createElement('span');
      completedElement.appendChild(checkmark);
      const text = document.createElement('span');
      text.textContent = __('Completed', 'planet4-blocks');
      completedElement.appendChild(text);
      completedElement.classList.add('completed-message');
      const figure = action.querySelector('.wp-block-post-featured-image'); // For Actions List blocks.
      const image = action.querySelector('img'); // For Take Action Boxout blocks.
      if (figure) {
        figure.replaceWith(completedElement);
      } else {
        image.replaceWith(completedElement);
      }
    } else {
      action.onclick = () => {
        localStorage.setItem('completedActions', `${completedActions ? completedActions + ',' : ''}${actionId}`);
      };
    }
  });

  reorderCompletedPosts();
};

document.addEventListener('DOMContentLoaded', () => {
  // Update header layout
  const header = document.getElementById('header');
  const gpLogo = document.querySelector('.site-logo');
  if (header && gpLogo) {
    const container = document.createElement('div');
    container.classList.add('container');
    header.append(container);

    gpLogo.querySelector('img').remove();

    // Replace Greenpeace logo
    const svgString = `
    <svg width="177" height="52" viewBox="0 0 177 52" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M26.4098 2.77272C26.1718 2.97497 25.7718 3.02441 23.6928 3.38646C23.6928 3.38646 23.6124 3.39495 23.2824 3.55675C22.7996 3.55476 22.0102 3.91681 21.7772 4.04665C21.6802 4.10109 21.5608 4.37425 21.523 4.87963C21.6614 5.04642 21.7336 5.03444 21.9121 5.03444C22.9085 5.03444 24.3297 4.53505 24.5024 4.56502C25.1494 4.70934 25.4491 5.70661 25.4491 6.21998C25.4491 6.27691 25.3863 6.59252 25.3719 6.62948C25.2915 6.84571 24.9024 7.02649 24.4314 7.06944C22.1926 7.27269 21.1454 7.44648 20.8861 7.63025C20.8352 7.66571 20.7584 7.9139 20.7584 8.05123C20.7584 8.57909 21.8803 8.71492 22.0697 8.71492C22.7642 8.71492 23.1119 8.34587 23.365 8.34587C23.6694 8.34587 24.2929 9.08147 24.2929 9.90995C24.2929 10.4528 23.9745 11.3412 22.59 11.3412C22.2294 11.3412 20.7065 11.0725 19.6106 10.3035C19.6106 10.3035 19.6437 10.0812 19.1858 9.75614C19.0307 9.49096 18.7469 8.55262 18.7469 7.836C18.7469 6.24345 19.5348 5.18575 19.6416 4.56951C19.6416 4.56951 19.2662 4.04216 19.1198 3.8469C19.039 3.73903 18.9517 3.64664 18.9517 3.24913C18.9517 2.00816 19.7656 1.77544 19.806 1.77544L20.0888 1.77994C20.0888 1.77994 20.691 1.50428 20.7714 1.38842L21.2175 1.35795C21.4804 1.3245 24.462 0.554443 25.0574 0.554443C25.5317 0.554443 25.7174 0.632347 25.9045 0.922489C26.03 1.11625 26.5364 2.04162 26.5364 2.37271C26.5364 2.45061 26.4714 2.71928 26.4098 2.77122V2.77272Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M27.8865 7.6115C27.819 7.67666 27.7445 7.92744 27.7266 8.07752C27.7041 8.26708 28.3999 8.56969 29.0296 8.60277C30.8731 8.69755 30.6364 7.84698 31.1762 8.11454C31.5285 8.28929 31.8397 9.17936 31.8397 9.69869C31.8397 10.8909 30.6791 11.2271 29.6485 11.2271C28.2353 11.2271 26.9715 10.568 26.9715 10.568C26.9715 10.568 25.8855 9.21441 25.8855 8.24092C25.8855 6.00711 27.0724 3.5477 27.1314 3.4307C27.1314 3.4307 27.2284 2.78796 27.2866 2.3718C27.3514 1.90085 27.6688 1.80508 27.9338 1.51185C28.5372 1.45113 29.6105 0.974745 32.9758 0.609932C33.4007 0.56402 33.9296 1.15197 34.2159 2.045C34.2668 2.20248 34.1841 2.82745 33.9711 2.89212C33.8442 2.93112 33.507 2.97061 30.7854 3.25446C30.3171 3.30284 29.8293 3.38232 29.6353 3.52153C29.4176 3.67654 29.0025 4.36865 28.9419 4.60067C28.8802 4.83862 29.0025 4.96647 29.3075 4.93439C30.7427 4.78185 31.7097 4.1544 31.8211 4.1544C32.3333 4.1544 32.8195 4.83615 32.9626 5.58256C33.0468 6.01896 32.9296 6.3813 32.7911 6.47115C32.3724 6.74315 31.7027 6.91347 30.9915 7.0507C30.6826 7.11093 30.4638 7.10056 30.338 7.0897C30.2767 7.08378 30.1277 7.18794 30.0412 7.20127C29.0036 7.34641 28.0685 7.4328 27.8865 7.6115Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M58.8325 1.77284C58.8325 2.33151 58.6715 2.69807 58.4715 2.77406C57.5946 3.11012 54.6521 3.52859 53.2924 3.98077C53.0453 4.06371 52.6038 4.80272 52.6038 5.09062C52.6038 5.23832 52.7743 5.28808 53.0284 5.25491C54.9905 4.99591 55.331 4.82788 56.1501 4.45971C56.2871 4.46934 56.4837 4.48593 56.5972 4.60794C56.833 4.85998 57.0731 5.35551 57.0731 6.0774C57.0731 6.51834 56.8791 6.98337 56.1109 7.09949C55.0944 7.25307 52.7587 7.59876 52.0736 7.6801C51.7304 7.72184 51.5303 7.81014 51.4999 7.85509C51.1919 8.29924 51.3142 9.22876 53.4094 8.76962C54.2889 8.57697 54.4637 8.25429 54.9622 8.25429C54.9952 8.25429 55.0553 8.26125 55.0909 8.27035C55.5194 8.63263 55.6129 9.06447 55.6129 9.65365C55.6129 10.3552 55.3123 10.8224 54.6921 11.1397C54.6412 11.1654 54.4094 11.2103 54.3867 11.2152C54.3611 11.22 54.0792 11.38 53.9444 11.4164C53.5777 11.5148 53.2993 11.5336 53.1645 11.5336C51.7256 11.5336 49.4373 10.8721 49.4373 8.21523C49.4373 5.80502 51.0736 4.12151 51.5082 2.52897C51.5082 2.52897 51.6191 2.41659 51.7256 2.25338C51.7565 1.97886 52.0049 1.33671 52.3137 1.30353C53.0819 1.22165 55.4494 0.705794 57.538 0.0315324C57.7142 -0.0251911 57.8695 -0.00485438 58.0017 0.0882559C58.3662 0.345117 58.8303 1.05523 58.8303 1.77069L58.8325 1.77284Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M18.4444 8.72312C18.0184 8.24393 16.642 7.48689 16.1699 7.00406C16.3733 6.77356 17.4773 5.21787 17.4773 3.98893C17.4773 2.25321 16.2182 0.173584 14.5238 0.173584C14.5238 0.173584 14.0306 0.18191 13.4317 0.229256C13.3228 0.398353 12.9618 0.359332 12.9618 0.359332C12.3666 0.626765 11.8153 1.0737 11.8153 2.51024C11.8153 2.76779 12.1749 3.03418 12.3928 3.23398C12.3524 3.69548 12.1916 4.48893 11.9809 5.02848C11.9039 5.2236 11.3549 5.3006 11.3549 5.3006L11.0651 5.67469C10.8769 6.78865 11.0687 6.92133 11.4533 7.4229C11.5052 8.01187 11.2746 9.03061 11.2746 9.60919C11.2746 10.027 11.4344 9.98172 11.3501 10.4099C11.3501 10.4099 11.4155 10.4812 11.4485 10.5806C11.5953 11.0218 12.0993 11.412 12.582 11.412C13.065 11.412 13.2887 11.0384 13.2887 10.8621C13.2887 10.3673 13.1608 8.8558 13.1739 8.71739C13.2153 8.24028 13.4129 7.97753 13.4129 7.97753C13.7382 7.97753 15.1865 9.29076 16.4231 10.552C16.6101 10.7424 16.9816 10.9375 17.3106 10.9375C18.0631 10.9375 18.3721 10.0894 18.5875 9.89327C18.7059 9.7403 18.7211 9.03322 18.4455 8.72312H18.4444ZM14.1265 5.3776C14.0542 5.41559 13.8399 5.34222 13.8127 5.31621C13.8127 5.31621 14.1936 3.08361 14.2271 2.60233C14.7631 2.45301 15.4763 2.74906 15.4763 3.45875C15.4763 4.0727 15.1938 4.80736 14.1275 5.3776H14.1265Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M49.4591 0.781499L48.9186 0.624373L48.6394 0.482287C47.9156 0.340201 46.1701 0.312196 45.5866 0.372352C45.4884 0.383241 45.1039 0.288342 44.9408 0.250488C44.5041 0.503549 44.1203 0.619708 44.1203 0.619708C44.0221 0.619708 43.7444 0.506141 43.7444 0.506141C43.331 0.537774 42.2438 0.796019 41.7516 1.08797C41.5231 1.22435 41.3718 1.47586 41.3 1.61795C41.2961 1.62417 41.2938 1.63091 41.2914 1.63713C41.2735 1.67706 41.2072 1.74603 41.1971 1.63713C41.1854 1.5329 41.1698 1.41934 41.1487 1.33999C41.0122 0.83232 40.3805 0.439765 39.9967 0.439765C39.8407 0.439765 39.5155 0.613484 39.4858 0.800687C39.4492 1.03508 39.4234 2.0888 39.3119 3.1109C39.301 3.21409 39.3002 5.14005 39.1076 5.781C39.0631 5.79085 38.9258 5.84012 38.8837 5.77633C38.3994 5.04774 37.1335 3.78763 37.0274 2.95274C36.9276 2.18111 37.0539 0.968702 36.6569 0.65497C36.5103 0.539329 35.8037 0.325162 35.5564 0.325162C35.2569 0.325162 35.0034 0.457396 34.8677 0.648228L34.8358 0.881063L34.6158 1.21347C34.5495 1.42867 34.5105 1.79893 34.4887 2.59752L34.6735 3.5465C34.6735 3.5465 34.6688 3.76533 34.5043 3.95461L34.5518 4.68579C34.5518 5.50927 33.7992 8.33909 33.7992 9.19213C33.7992 11.1082 35.4738 10.9511 35.5705 10.8707C35.6914 10.7701 35.93 10.3594 35.9409 10.2422C36.0548 9.11019 36.1703 7.17853 36.476 6.6107C36.5384 6.49454 36.6967 6.43906 36.7786 6.51581C37.0461 6.76887 37.3441 7.33825 37.3807 7.39115C37.6787 7.81378 38.5476 8.86751 38.7106 9.81441C38.7254 9.89323 38.7098 10.0851 38.7355 10.2329C38.7917 10.556 38.9282 10.9298 39.365 11.2928C39.4851 11.3924 39.9593 11.4515 40.2775 11.3971C40.5957 11.3426 41.1752 11.2799 41.1752 9.78485C41.1752 8.81461 41.0169 8.42517 41.0286 8.23848C41.0403 8.05128 41.2548 6.27675 41.2548 3.81045C41.2548 3.81045 41.1409 3.58798 41.0972 3.45315C41.1565 3.24002 41.1861 3.07304 41.2017 2.95948C41.2095 2.89829 41.2415 2.85317 41.2665 2.90399C41.2844 2.93977 41.3055 2.97867 41.3297 3.01652C41.4537 3.21306 41.7352 3.38315 42.0698 3.38315C42.601 3.38315 43.2967 2.7619 43.7787 2.8734C43.845 2.88844 43.916 2.77176 44.2935 2.73961C44.3013 2.96933 44.3067 3.46819 44.2436 4.16151C44.2155 4.48199 44.0689 4.552 43.4745 4.552C43.2577 4.552 43.1197 4.72468 43.0573 4.86314C42.9777 5.03686 42.8264 5.8733 42.8264 6.10303C42.8264 6.57129 43.349 7.1749 43.9846 7.34396C44.0236 7.54049 43.8341 9.05211 43.8341 9.81285C43.8341 10.5736 44.015 10.9179 44.0486 10.9485C44.093 10.99 44.6304 11.3851 45.0438 11.3851C45.3534 11.3851 45.7052 11.2068 45.7653 11.0823C45.8011 11.0092 45.8908 10.808 45.8994 10.4331C45.9384 8.69482 46.1342 6.86117 46.3526 6.79739C47.3969 6.48884 48.4085 6.09836 49.4427 5.34696C49.9755 4.95907 50.6462 4.15322 50.6462 3.34633C50.6462 2.29105 49.9622 1.0999 49.4615 0.780462L49.4591 0.781499ZM46.39 4.26108C46.259 4.26108 46.1763 4.2196 46.142 4.1107C46.0187 3.72488 45.9618 2.90762 45.9618 2.47358C46.4173 2.37869 48.4155 2.50159 48.4155 3.01756C48.4155 3.48271 47.0717 4.26315 46.3892 4.26108H46.39Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.7642 6.98073C10.7642 6.67215 10.4623 5.63319 10.2422 5.38607C9.96322 5.07384 9.63546 4.99897 9.23199 4.99897C8.96551 4.99897 4.50148 5.68796 3.94061 6.03429C3.67313 6.19984 3.57251 6.57963 3.57251 7.13107C3.57251 7.90345 4.08257 8.24673 4.22702 8.24673C4.55328 8.24673 6.82066 7.80667 7.63457 7.65512C7.80243 7.62408 7.86768 7.69407 7.86519 7.76163C7.86519 7.96005 7.80841 8.19195 7.72074 8.29055C7.40494 8.64296 6.92825 8.85964 6.51732 8.99415C5.87526 8.8712 5.33332 9.41777 4.68727 9.09944C4.40883 9.09579 4.00785 9.29726 3.81608 8.98624C3.16904 8.84016 2.47667 8.79695 1.95715 8.36724C1.76089 8.1816 1.71009 7.96249 1.71009 7.69651C1.71009 6.99473 2.75711 5.19435 4.53684 3.51935C4.90594 3.1712 6.2324 2.2004 6.81668 2.2004C7.20719 2.2004 7.34368 3.07077 7.65449 3.40066C7.7317 3.48283 8.05597 3.49074 8.21536 3.42196C8.55756 3.27345 8.82604 3.08842 8.82604 2.68732C8.82604 1.78834 8.47338 1.05736 8.179 0.695212C7.9932 0.466969 7.11754 0.092041 6.76737 0.092041C6.01921 0.092041 5.66804 0.536962 5.39209 0.546094C4.2848 1.22535 3.7583 1.85104 3.53216 2.05494C3.4435 2.13406 3.33342 2.16328 3.33342 2.16328C3.33342 2.16328 3.26468 2.40978 3.1526 2.56803C3.11126 2.59298 2.72174 2.85105 2.72174 2.85105C2.21168 3.34649 0.00506592 6.10428 0.00506592 7.13594C0.00506592 8.10369 0.647624 9.45429 0.88522 9.67584C1.69365 10.4306 3.19245 10.9601 4.88253 10.9601C6.06653 10.9601 7.16834 10.4933 7.49958 10.3107C7.58028 10.265 7.63556 10.2705 7.6261 10.3581C7.61564 10.4573 7.60119 10.5949 7.59422 10.7051C7.58725 10.8207 7.53146 11.3995 7.53146 11.7921C7.53146 12.4781 7.71726 12.8305 7.90653 13.0118C7.9932 13.0946 8.57151 13.2389 8.94907 13.2389C9.13736 13.2389 9.72861 12.9595 9.72861 12.3448C9.72861 11.9875 9.68876 11.5079 9.69474 11.3922C9.85912 8.33072 10.7632 7.48957 10.7632 6.98317L10.7642 6.98073Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M83.7613 1.84367C83.5953 1.10313 83.0238 0.424009 82.541 0.315512C82.1063 0.413772 78.5288 1.09955 76.1793 1.4061C75.8548 1.44858 75.4544 1.46393 75.4544 1.46393L75.187 1.60006C75.187 1.60006 74.7194 1.64049 74.4951 1.80375C74.1909 2.02586 73.7829 2.45882 73.6713 3.13436L73.7182 3.74951C72.9908 5.19169 72.5029 6.35137 72.5029 7.92353C72.5029 7.95424 72.5042 7.98853 72.5067 8.02384C72.5067 8.14002 72.494 8.19682 72.4624 8.16816C72.4256 8.11289 72.38 8.04534 72.3293 7.98853C72.0492 7.66816 71.9555 7.62517 71.8275 7.62517C71.4397 7.62517 71.1495 8.34933 69.8505 8.34933C68.6821 8.34933 66.4884 7.12517 66.4884 6.48596C66.4884 5.08063 68.3615 3.32525 69.7542 3.32525C69.9975 3.32525 70.0609 3.39485 70.0609 3.56067C70.0609 3.83856 69.8531 4.27254 69.8531 4.54839C69.8531 5.21881 70.8631 5.70192 71.394 5.70192C71.5461 5.70192 72.636 5.3007 72.636 3.71881C72.636 2.78891 71.958 1.25718 70.8453 1.25718C69.4437 1.25718 67.3438 2.00027 65.9372 2.9798C65.9372 2.9798 65.8637 3.15227 65.7408 3.26845C65.6178 3.38411 65.2795 3.61236 65.2795 3.61236C64.9449 4.04174 64.6775 4.61441 64.5863 4.82168C64.5597 4.88207 64.528 4.96242 64.4976 5.04379C64.4367 5.205 64.3379 5.25924 64.3163 5.16457C64.3087 5.08422 64.2986 4.98033 64.2885 4.84778C64.2403 4.25003 64.1896 3.88718 64.0996 3.44551C64.0996 3.44551 63.9425 3.02075 63.9019 2.82832C63.8905 2.77254 63.8829 2.53968 63.8829 2.53968C63.556 1.2843 62.7867 0.463415 62.6803 0.424009C62.1708 0.238233 62.0441 0.191151 61.8236 0.331887C60.9543 0.885627 59.9354 2.57397 58.3652 5.46856C58.3652 5.46856 58.1143 5.75362 57.7582 5.96447C57.8 6.40818 57.7722 6.64206 57.7316 6.77C57.4186 7.76745 56.5163 9.01669 56.5581 9.27309L56.6075 9.57759L56.5733 9.93839C56.5733 10.1702 57.2881 11.0054 57.8849 11.0054C57.9356 11.0054 57.9889 11.0003 58.0243 10.9911C58.625 10.4589 58.7961 9.42252 59.3322 8.55302C59.3917 8.4568 59.412 8.4394 59.5565 8.38618C59.8999 8.25721 60.5982 8.13899 60.9036 8.10214C61.209 8.0653 61.4764 8.13029 61.4764 8.13029L61.7425 8.04278C61.9922 8.02896 62.1278 8.10317 62.1278 8.3043C62.1278 9.28537 62.148 10.0863 62.2139 10.3852C62.3191 10.8575 62.7563 11.1794 63.6206 11.2455C63.7157 11.2455 64.0705 11.0326 64.1782 10.7178C64.3493 10.2173 64.2441 9.58424 64.2441 9.04023C64.2441 8.22651 64.2707 7.74237 64.2923 7.47727C64.3113 7.38873 64.3759 7.36161 64.4025 7.44452C64.4874 7.6656 64.6319 7.99467 64.8283 8.22855C65.908 9.51566 67.7342 11.0193 70.2826 11.1794C71.2977 11.2429 72.0467 10.726 72.4383 9.72856C72.5245 9.51208 72.584 9.3217 72.6144 9.21423C72.6347 9.18455 72.674 9.1953 72.7031 9.24852C72.7538 9.34064 72.84 9.47933 72.9731 9.64719C73.85 10.7496 75.0957 11.093 76.6646 10.856C78.4122 10.5924 78.6492 10.4138 78.7974 10.2219C79.042 9.90615 79.132 9.43071 79.1662 9.05097C79.1928 8.7695 79.2271 8.43685 78.9888 8.19785C78.7189 7.92712 77.8799 8.20143 76.7736 8.38976C75.3099 8.63797 74.6928 8.01924 74.7092 7.82988C74.7206 7.71525 74.7764 7.48444 74.9259 7.44656C75.0717 7.41023 75.3733 7.46908 75.5076 7.50337C75.5634 7.49979 76.3808 7.34728 76.9903 7.34728C77.2159 7.34728 77.4807 7.38055 77.5695 7.38413C77.5695 7.38413 78.5326 7.31299 79.1041 7.19938C79.4539 7.12978 79.7732 6.82067 79.8011 6.62926C79.886 6.06631 79.8227 5.72752 79.7175 5.51104C79.312 4.6794 78.8342 4.58626 78.7328 4.60725C78.2221 4.71523 77.2019 5.01564 75.832 4.9445C75.666 4.93632 75.5608 4.7398 75.5773 4.6098C75.6204 4.25463 76.0589 3.67377 76.472 3.59496C77.572 3.38411 80.8289 3.06015 82.0264 2.99976C82.7754 2.96189 83.5636 3.19014 83.7145 2.93579C83.8893 2.63896 83.8057 2.02944 83.7639 1.84009L83.7613 1.84367ZM62.2215 5.2311C62.1316 5.40356 61.6107 5.53355 60.73 5.54584C60.6907 5.54584 60.6489 5.46754 60.6679 5.41789C61.0316 4.55197 61.7362 3.02689 61.8312 3.01512C61.9288 3.00335 62.0783 3.05299 62.1417 3.13334C62.3229 3.36619 62.3331 5.0095 62.2215 5.22956V5.2311Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.88579 41.2532L8.50993 36.6857H6.15654L5.5324 41.2532C5.50438 41.4514 5.39076 41.5935 5.19231 41.5935H2.18676C1.98831 41.5935 1.84667 41.4514 1.87469 41.2532L2.49883 36.6857H0.315111C0.145441 36.6857 -0.0249833 36.5437 0.00304258 36.3741L0.400701 32.856C0.428727 32.6568 0.542345 32.5158 0.740795 32.5158H3.03737L3.54789 28.686H1.25131C1.08089 28.686 0.910462 28.544 0.939246 28.3733L1.33615 24.8563C1.36418 24.657 1.47779 24.515 1.67624 24.515H4.11522L4.7386 19.8627C4.76738 19.6645 4.88024 19.5225 5.07869 19.5225H8.11303C8.31147 19.5225 8.45312 19.6645 8.42509 19.8627L7.80095 24.515H10.1543L10.7785 19.8627C10.8065 19.6645 10.9201 19.5225 11.1186 19.5225H14.1529C14.3514 19.5225 14.493 19.6645 14.4642 19.8627L13.8408 24.515H15.9958C16.1654 24.515 16.3359 24.657 16.3078 24.8277L15.9102 28.3447C15.8822 28.544 15.7685 28.686 15.5701 28.686H13.2735L12.735 32.5158H15.0315C15.202 32.5158 15.3716 32.6568 15.3436 32.8274L14.9467 36.3455C14.9179 36.5437 14.8051 36.6857 14.6059 36.6857H12.1676L11.5435 41.2532C11.5155 41.4514 11.4019 41.5935 11.2034 41.5935H8.19785C7.99941 41.5935 7.85776 41.4514 7.88579 41.2532ZM9.07725 32.5229L9.58702 28.6932H7.23363L6.72387 32.5229H9.07725Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M29.9475 19.8693V23.3302C29.9475 23.557 29.8343 23.6704 29.6072 23.6704H26.2901V41.2598C26.2901 41.4866 26.1768 41.6001 25.9497 41.6001H21.9519C21.7248 41.6001 21.6115 41.4866 21.6115 41.2598V23.6704H18.2945C18.0674 23.6704 17.9541 23.557 17.9541 23.3302V19.8693C17.9541 19.6425 18.0674 19.5291 18.2945 19.5291H29.6072C29.8343 19.5291 29.9475 19.6425 29.9475 19.8693Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M34.4025 18.9617C36.1892 18.9617 37.0401 20.2382 37.0401 21.4582C37.0401 22.6781 36.1892 23.983 34.4025 23.983C32.6158 23.983 31.7649 22.7064 31.7649 21.4582C31.7649 20.2099 32.6441 18.9617 34.4025 18.9617ZM32.0768 41.2519V25.5435C32.0768 25.3161 32.1903 25.2029 32.4172 25.2029H36.3311C36.558 25.2029 36.6713 25.3161 36.6713 25.5435V41.2593C36.6713 41.4867 36.558 41.5999 36.3311 41.5999H32.4172C32.1903 41.5999 32.0768 41.4867 32.0768 41.2593V41.2519Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M55.3318 41.2535V30.6996C55.3318 29.5643 54.9064 28.9402 53.7444 28.9402C52.5814 28.9402 52.1271 29.3944 52.1271 30.6996V41.2535C52.1271 41.4806 52.014 41.5941 51.7868 41.5941H47.8735C47.6463 41.5941 47.5332 41.4806 47.5332 41.2535V30.6996C47.5332 29.5643 47.0228 28.9402 45.9159 28.9402C44.81 28.9402 44.3285 29.5643 44.3285 30.6996V41.2535C44.3285 41.4806 44.2145 41.5941 43.9882 41.5941H40.074C39.8468 41.5941 39.7337 41.4806 39.7337 41.2535V25.5427C39.7337 25.3157 39.8468 25.2022 40.074 25.2022H43.4208C43.619 25.2022 43.704 25.2879 43.733 25.4292L44.0443 26.7908H44.3566C44.9801 25.5713 46.2571 24.9187 48.0717 24.9187C49.5179 24.9187 50.9931 25.3157 51.7017 26.7908H52.014C52.8077 25.5142 53.9426 24.9187 55.7291 24.9187C58.1111 24.9187 59.9266 26.2239 59.9266 29.5998V41.2605C59.9266 41.4875 59.8135 41.6011 59.5863 41.6011H55.6721C55.4458 41.6011 55.3318 41.4875 55.3318 41.2605V41.2535Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M62.5909 34.9912V31.8697C62.5909 27.3023 64.519 24.9192 68.8005 24.9192C73.0819 24.9192 74.7832 27.6432 74.7832 31.9554L74.755 33.8279C74.755 34.0549 74.6415 34.168 74.4146 34.168H67.1274V36.438C67.1274 37.7426 67.5812 38.3954 68.8005 38.3954C69.878 38.3954 70.4735 37.7717 70.4735 36.7215V36.5228C70.4735 36.2958 70.587 36.1827 70.8133 36.211L74.3011 36.665C74.5281 36.6933 74.6415 36.7781 74.6415 37.0051C74.6415 40.2679 72.1748 41.8852 68.8005 41.8852C64.2921 41.8852 62.5909 39.2468 62.5909 34.9912ZM70.4735 31.5579V30.4512C70.4735 29.09 70.0479 28.409 68.8005 28.409C67.553 28.409 67.1274 29.09 67.1274 30.4512V31.5579H70.4735Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M86.7786 19.8693V23.3302C86.7786 23.557 86.6654 23.6704 86.4383 23.6704H83.1212V41.2598C83.1212 41.4866 83.0079 41.6001 82.7808 41.6001H78.783C78.5559 41.6001 78.4426 41.4866 78.4426 41.2598V23.6704H75.1256C74.8985 23.6704 74.7852 23.557 74.7852 23.3302V19.8693C74.7852 19.6425 74.8985 19.5291 75.1256 19.5291H86.4383C86.6654 19.5291 86.7786 19.6425 86.7786 19.8693Z" fill="#198700"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M86.8661 35.1608V31.6145C86.8661 27.3588 88.7942 24.9192 93.0765 24.9192C97.3588 24.9192 99.287 27.3588 99.287 31.6145V35.1608C99.287 39.4738 97.3301 41.8852 93.0765 41.8852C88.823 41.8852 86.8661 39.4172 86.8661 35.1608ZM93.0765 38.3954C94.3244 38.3954 94.7499 37.7144 94.7499 36.4663V30.3381C94.7499 29.09 94.3244 28.409 93.0765 28.409C91.8287 28.409 91.4032 29.09 91.4032 30.3381V36.4663C91.4032 37.7144 91.8287 38.3954 93.0765 38.3954Z" fill="#198700"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M100.126 48.27C100.955 47.7383 102.143 47.719 103.194 47.6989C105.757 47.6536 108.324 47.608 110.884 47.5628C116.015 47.472 121.139 47.3816 126.27 47.2963C136.631 47.1169 146.993 46.9319 157.362 46.7522C160.247 46.7011 163.132 46.6501 166.018 46.599C167.512 46.5744 169.01 46.5441 170.508 46.5194C171.828 46.4954 173.353 46.3305 174.619 46.6154C174.749 46.6442 174.857 46.685 174.945 46.7377C175.349 46.8352 175.71 46.9397 175.98 47.1926C176.265 47.4562 176.419 47.7801 176.43 48.109C176.452 48.7335 175.994 49.3803 175.293 49.7958C173.495 50.8692 170.523 50.4991 168.376 50.4738C166.926 50.4521 154.458 50.4432 149.689 50.4432C139.39 50.4531 129.087 50.7923 118.791 50.9025C112.951 50.9679 108.163 51.3593 102.35 51.0499C100.569 50.956 99.3765 50.0992 99.4004 49.7523C99.1926 49.2237 99.5376 48.6423 100.136 48.2638L100.126 48.27Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M110.772 41.2813L108.674 33.3939L106.83 33.4226V41.2527C106.83 41.4795 106.717 41.5929 106.49 41.5929H102.491C102.265 41.5929 102.151 41.4795 102.151 41.2527V19.8693C102.151 19.6425 102.265 19.5291 102.491 19.5291H109.155C113.466 19.5291 115.479 22.0253 115.479 26.1677C115.479 29.4017 114.628 31.2737 112.842 32.2669L115.451 41.175C115.508 41.4018 115.394 41.6001 115.196 41.6001H111.141C110.942 41.6001 110.829 41.4866 110.772 41.2884V41.2813ZM108.531 29.2883C110.091 29.2883 110.715 28.2103 110.715 26.366C110.715 24.5216 110.091 23.5294 108.504 23.5294H106.83V29.2883H108.531Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M117.125 34.9912V31.8697C117.125 27.3023 119.053 24.9192 123.334 24.9192C127.616 24.9192 129.317 27.6432 129.317 31.9554L129.289 33.8279C129.289 34.0549 129.175 34.168 128.949 34.168H121.661V36.438C121.661 37.7426 122.115 38.3954 123.334 38.3954C124.412 38.3954 125.007 37.7717 125.007 36.7215V36.5228C125.007 36.2958 125.121 36.1827 125.347 36.211L128.835 36.665C129.062 36.6933 129.175 36.7781 129.175 37.0051C129.175 40.2679 126.709 41.8852 123.334 41.8852C118.826 41.8852 117.125 39.2468 117.125 34.9912ZM125.007 31.5579V30.4512C125.007 29.09 124.582 28.409 123.334 28.409C122.087 28.409 121.661 29.09 121.661 30.4512V31.5579H125.007Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M131.134 37.119V36.665C131.134 36.438 131.247 36.3241 131.474 36.2958L134.793 35.8418C135.02 35.8135 135.133 35.9557 135.133 36.1827V36.8064C135.133 38.027 135.899 38.3954 136.665 38.3954C137.431 38.3954 138.197 37.9987 138.197 37.119C138.197 34.3385 131.077 35.3313 131.134 29.7137C131.162 26.5647 133.347 24.9192 136.694 24.9192C140.041 24.9192 141.998 26.5365 141.998 29.2031V29.7137C141.998 29.9406 141.884 30.0263 141.658 30.0545L138.395 30.5085C138.169 30.5368 138.055 30.4229 138.055 30.1959V29.5157C138.055 28.6925 137.488 28.3234 136.779 28.3234C136.07 28.3234 135.559 28.7208 135.559 29.4584C135.559 32.2106 142.622 31.5296 142.622 36.8354C142.622 40.2396 140.239 41.8852 136.864 41.8852C133.488 41.8852 131.134 40.4949 131.134 37.119Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M147.072 18.9617C148.859 18.9617 149.71 20.2382 149.71 21.4582C149.71 22.6781 148.859 23.983 147.072 23.983C145.285 23.983 144.434 22.7064 144.434 21.4582C144.434 20.2099 145.314 18.9617 147.072 18.9617ZM144.746 41.2519V25.5435C144.746 25.3161 144.86 25.2029 145.087 25.2029H149.001C149.227 25.2029 149.341 25.3161 149.341 25.5435V41.2593C149.341 41.4867 149.227 41.5999 149.001 41.5999H145.087C144.86 41.5999 144.746 41.4867 144.746 41.2593V41.2519Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M151.552 37.119V36.665C151.552 36.438 151.665 36.3241 151.892 36.2958L155.211 35.8418C155.438 35.8135 155.552 35.9557 155.552 36.1827V36.8064C155.552 38.027 156.317 38.3954 157.083 38.3954C157.849 38.3954 158.615 37.9987 158.615 37.119C158.615 34.3385 151.495 35.3313 151.552 29.7137C151.58 26.5647 153.765 24.9192 157.112 24.9192C160.459 24.9192 162.416 26.5365 162.416 29.2031V29.7137C162.416 29.9406 162.303 30.0263 162.076 30.0545L158.813 30.5085C158.587 30.5368 158.474 30.4229 158.474 30.1959V29.5157C158.474 28.6925 157.906 28.3234 157.197 28.3234C156.488 28.3234 155.977 28.7208 155.977 29.4584C155.977 32.2106 163.04 31.5296 163.04 36.8354C163.04 40.2396 160.657 41.8852 157.282 41.8852C153.906 41.8852 151.552 40.4949 151.552 37.119Z" fill="#66CC00"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M165.761 38.2216V28.7486H164.116C163.889 28.7486 163.775 28.6343 163.775 28.4075V25.5433C163.775 25.3156 163.889 25.2022 164.116 25.2022H165.761V22.0255C165.761 21.7987 165.874 21.6853 166.101 21.6853H170.015C170.242 21.6853 170.356 21.7987 170.356 22.0255V25.2022H172.766C172.993 25.2022 173.107 25.3156 173.107 25.5433V28.4075C173.107 28.6343 172.993 28.7486 172.766 28.7486H170.356V36.7752C170.356 37.5699 170.838 37.8815 171.462 37.8815H172.483C172.71 37.8815 172.823 37.9948 172.823 38.2216V41.2573C172.823 41.4841 172.71 41.5975 172.483 41.5975H169.193C167.037 41.5975 165.761 40.3779 165.761 38.2216Z" fill="#66CC00"/>
    </svg>
    `;

    const svgParser = new DOMParser();
    const svgDoc = svgParser.parseFromString(svgString, 'image/svg+xml');
    const svgElement = svgDoc.documentElement;
    gpLogo.prepend(svgElement);
    container.append(gpLogo);
  }

  const actionsDeadline = Boolean(window.p4_vars.features.actions_deadline);
  const actionsTaskType = Boolean(window.p4_vars.features.actions_task_type);
  const actionsList = document.querySelector('.actions-list');
  /// Move columns content into a container
  const columns = document.querySelector('.actions-list + .wp-block-columns');

  if (columns && actionsList) {
    const columnsWrapper = document.createElement('div');
    columnsWrapper.classList.add('columns-wrapper');
    columnsWrapper.classList.add('block-wide');
    columns.classList.add('container');
    columnsWrapper.append(columns);
    actionsList.parentNode.insertBefore(columnsWrapper, actionsList.nextSibling);
  }

  // Iterate posts
  for (const post of [
    ...Array.from(document.querySelectorAll('.wp-block-post-template .wp-block-post')),
    ...document.querySelectorAll('.boxout'),
  ]) {
    const isBoxout = post.classList.contains('boxout') || false;

    const cta = post.querySelector('.btn-primary');

    if (actionsTaskType) {
      const taskType = cta.getAttribute('data-tasktype');

      if (taskType) {
        const chipTaskType = document.createElement('span');
        chipTaskType.classList.add('chip-tasktype');

        switch (taskType) {
        case 'online':
          chipTaskType.innerHTML = __('Do it Online', 'planet4-blocks');
          break;
        case 'irl':
          chipTaskType.innerHTML = __('Do it Offline', 'planet4-blocks');
          break;
        }

        post.append(chipTaskType);
      }
    }

    if (actionsDeadline) {
      const deadline = cta.getAttribute('data-deadline');
      if (deadline && !isBoxout) {
        const diffDates = new Date(deadline) - Date.now();
        if (diffDates > 0) {
          const chipDeadline = document.createElement('span');
          const secondsInDay = 1000 * 60 * 60 * 24;
          const featuredImage = post.querySelector('.wp-block-post-featured-image');
          if (featuredImage) {
            chipDeadline.classList.add('chip-deadline');
            chipDeadline.innerHTML = `${Math.round((Date.parse(deadline) - Date.now()) / secondsInDay)} days left`;
            featuredImage.append(chipDeadline);
          }
        }
      }
    }
  }

  // Mark Actions as completed based on user interaction.
  markActionsAsCompleted();
});
